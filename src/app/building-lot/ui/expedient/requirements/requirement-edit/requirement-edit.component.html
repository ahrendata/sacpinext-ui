<div class="row">
  <div class="col-md-12">
    <div class="row">
      <div class="col-md-8">
        <ol class="breadcrumb">
          <li>
            <a routerLink="../">Requerimientos</a>
          </li>
          <li>Editar Requerimiento</li>
        </ol>
        <h1>Editar requerimiento </h1>
      </div>
      <div class="col-md-4">
        <div class="col-lg-12">
          <fieldset>
            <legend>
              <h3>Codigo Requerimiento</h3>
            </legend>
          </fieldset>
          <dl class="dl-horizontal right">
            <dd *ngIf="Codigo" class="sacpi-req">{{Codigo}}</dd>
            <dd *ngIf="!Codigo" class="sacpi-req">
              <em>No Registrado</em>
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <sacpi-loading [loading]="loading">
      <form [formGroup]="form" (ngSubmit)="confirmar(form)">
        <sacpi-form-fields-status [sacpiForm]="form"></sacpi-form-fields-status>
        <div class="row">
          <div class="col-md-2">
            <div class="form-group" [sacpiFormFieldValidationState]="form.get('IdTypeRequirement')">
              <label class="control-label" [sacpiFormRequiredLabel]="form.get('IdTypeRequirement')">Nivel Requerimiento
                <i class="fa fa-question-circle text-muted" ngbTooltip="Fecha atencion del requiremiento" placement="right"></i>
              </label>
              <ng-select formControlName="IdTypeRequirement" class="ng-select-sacpi" [items]="requirementType" bindLabel="Descryption"
                bindValue="IdContenedor" placeholder="Seleccione expediente"></ng-select>
              <sacpi-form-field-validation-messages [sacpiFormControl]="form.get('IdTypeRequirement')">
              </sacpi-form-field-validation-messages>
            </div>
          </div>
          <div class="col-md-2">
            <div class="form-group" [sacpiFormFieldValidationState]="form.get('IdExpedient')">
              <label class="control-label" [sacpiFormRequiredLabel]="form.get('IdExpedient')">Centro de Costo
                <i class="fa fa-question-circle text-muted" ngbTooltip="Expediente" placement="right"></i>
              </label>
              <ng-select formControlName="IdExpedient" class="ng-select-sacpi" [items]="expedients" bindLabel="Alias" bindValue="IdExpediente"
                placeholder="Seleccione expediente"></ng-select>
              <sacpi-form-field-validation-messages [sacpiFormControl]="form.get('IdExpedient')">
              </sacpi-form-field-validation-messages>
            </div>
          </div>
        </div>

        <!--/Entidad-->
        <div class="row">
          <div class="col-md-12">
            <table class="table table-striped table-bordered table-hover dataTable no-footer">
              <thead>
                <tr>
                  <td class="text-center">#</td>
                  <td class="text-left td-siacpi">Producto</td>
                  <td class="text-right">Cantidad</td>
                  <td class="text-center">Unidad Medida</td>
                  <td class="text-left">Descripcion</td>
                  <td colspan="2" rowspan="1" class="text-center">Acciones</td>
                  <td class="text-right">Acumulado</td>
                </tr>

              </thead>
              <tbody formArrayName="detalle">
                <ng-template ngFor let-item [ngForOf]="detalle.controls" let-i="index">
                  <tr [formGroupName]="i">
                    <td class="text-center">{{i+1}}</td>
                    <td [sacpiFormFieldValidationState]="item.get('IdProduct')" class="ng-product-filter">
                      <ng-select formControlName="IdProduct" class="ng-select-sacpi" bindLabel="Denominacion" [typeahead]="search" [items]="products"
                        placeholder="Seleccione algun producto"></ng-select>
                      <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('IdProduct')">
                      </sacpi-form-field-validation-messages>
                    </td>
                    <td [sacpiFormFieldValidationState]="item.get('Quantity')">
                      <input formControlName="Quantity" [sacpiNumberMask]="numberMask" type="text" class="form-control text-right">
                      <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('Quantity')">
                      </sacpi-form-field-validation-messages>
                    </td>
                    <td [sacpiFormFieldValidationState]="item.get('IdUnidCode')">
                      <ng-select formControlName="IdUnidCode" class="ng-select-sacpi" bindLabel="Denominacion" bindValue="IdContenedor" [items]="units"
                        placeholder="Seleccione una marca"></ng-select>
                      <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('IdUnidCode')">
                      </sacpi-form-field-validation-messages>
                    </td>
                    <td [sacpiFormFieldValidationState]="item.get('Observation')">
                      <input formControlName="Observation" type="text" class="form-control" placeholder="Descripcion" />
                      <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('Observation')">
                      </sacpi-form-field-validation-messages>
                    </td>
                    <td class="table-view-pf-actions">
                      <div class="table-view-pf-btn">
                        <button class="btn btn-default" type="button" (click)="removeDetalleFormControl(item,i)">
                          <span class="fa fa-trash"></span>
                          Eliminar
                        </button>
                      </div>
                    </td>
                    <td class="table-view-pf-actions">
                      <div class="dropdown dropdown-kebab-pf">
                        <button class="btn btn-default" type="button" *ngIf="item.get('Status').value==1">
                          <span class="pficon pficon-ok"></span>
                        </button>
                        <button class="btn btn-default" type="button" *ngIf="item.get('Status').value==2">
                          <span class="pficon pficon-warning-triangle-o"></span>
                        </button>
                        <button class="btn btn-default" type="button" *ngIf="item.get('Status').value==0">
                          <span class="pficon pficon-error-circle-o"></span>
                        </button>
                      </div>
                    </td>
                    <td [sacpiFormFieldValidationState]="item.get('Accumulate')">
                      <input formControlName="Accumulate" [sacpiNumberMask]="numberMask" type="text" class="form-control text-right" readonly>
                      <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('Accumulate')">
                      </sacpi-form-field-validation-messages>
                    </td>
                  </tr>
                </ng-template>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="10" class="text-left">
                    <button (click)="addDetalleFormControl()" type="button" class="btn btn-default">
                      <span class="fa fa-plus"></span> Agregar Productos
                    </button>
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
        <br>
        <sacpi-button-add [sacpiForm]="form" [working]="working" (sacpiOnSave)="save($event)"></sacpi-button-add>
        <sacpi-button-confirmar [sacpiForm]="form" [working]="working"></sacpi-button-confirmar>
        <sacpi-button-cancel (sacpiOnCancel)="cancel()"></sacpi-button-cancel>
      </form>
    </sacpi-loading>
    <br>
  </div>
</div>