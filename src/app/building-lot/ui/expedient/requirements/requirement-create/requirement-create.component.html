<div class="row">
  <div class="col-md-12">

    <ol class="breadcrumb">
      <li>
        <a routerLink="../">Requerimientos</a>
      </li>
      <li>Crear Requerimiento</li>
    </ol>

    <h1>Creacion de requerimiento</h1>

    <form [formGroup]="form" (ngSubmit)="save(form)">
      <sacpi-form-fields-status [sacpiForm]="form"></sacpi-form-fields-status>
      <div class="row">
        <div>
          <div class="form-group" [sacpiFormFieldValidationState]="form.get('IdRequirement')">
            <input type="hidden" #IdRequirement [value]="IdRequirement" />
            <sacpi-form-field-validation-messages [sacpiFormControl]="form.get('IdRequirement')">
            </sacpi-form-field-validation-messages>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group" [sacpiFormFieldValidationState]="form.get('AtentionDate')">
            <label class="control-label" [sacpiFormRequiredLabel]="form.get('AtentionDate')">Fecha Atencion
              <i class="fa fa-question-circle text-muted" ngbTooltip="Fecha atencion del requiremiento" placement="right"></i>
            </label>
            <div class="input-group of-float-right">
              <!-- <input formControlName="AtentionDate" class="form-control text-left" placeholder="dd-mm-yyyy" ngbDatepicker #d1="ngbDatepicker"> -->
              <div class="input-group-addon" (click)="d1.toggle()">
                <span class="glyphicon glyphicon-calendar"></span>
              </div>
            </div>
            <sacpi-form-field-validation-messages [sacpiFormControl]="form.get('AtentionDate')">
            </sacpi-form-field-validation-messages>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group" [sacpiFormFieldValidationState]="form.get('IdExpedient')">
            <label class="control-label" [sacpiFormRequiredLabel]="form.get('IdExpedient')">Centro de Costo
              <i class="fa fa-question-circle text-muted" ngbTooltip="Expediente" placement="right"></i>
            </label>
            <ng-select formControlName="IdExpedient" class="ng-select-sacpi" [items]="expedients"  bindLabel="Alias" bindValue="IdExpediente" placeholder="Seleccione expediente"></ng-select>
            <sacpi-form-field-validation-messages [sacpiFormControl]="form.get('IdExpedient')">
            </sacpi-form-field-validation-messages>
          </div>
        </div>
      </div>

      <!--/Entidad-->
      <div class="row">
        <div class="col-md-12">
          <table class="table table-striped table-bordered table-hover dataTable no-footer">
            <thead>
              <tr>
                <td class="text-center">#</td>
                <td class="text-left td-siacpi" >Producto</td>
                <td class="text-center">Unidad Medida</td>
                <td class="text-right">Quantity</td>
                <td class="text-left">Observation</td>
                <td colspan="2" rowspan="1" class="text-center">Acciones</td>
                <td class="text-right">Acomulado</td>
              </tr>
            </thead>
            <tbody formArrayName="detalle">
              <ng-template ngFor let-item [ngForOf]="detalle.controls" let-i="index">
                <tr [formGroupName]="i">
                  <td class="text-center">{{i+1}}</td>
                  <td [sacpiFormFieldValidationState]="item.get('IdProduct')" class="ng-product-filter">
                    <ng-select formControlName="IdProduct" class="ng-select-sacpi"  bindLabel="Denominacion" bindValue="IdProducto" [typeahead]="search" [items]="products" placeholder="Seleccione algun producto"></ng-select>
                    <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('IdProduct')">
                    </sacpi-form-field-validation-messages>
                  </td>
                  <td [sacpiFormFieldValidationState]="item.get('IdUnidCode')">
                    <ng-select formControlName="IdUnidCode" class="ng-select-sacpi"   bindLabel="Denominacion" bindValue="IdContenedor" [items]="units" placeholder="Seleccione una marca"></ng-select>
                    <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('IdUnidCode')">
                    </sacpi-form-field-validation-messages>
                  </td>
                  <td [sacpiFormFieldValidationState]="item.get('Quantity')">
                    <input formControlName="Quantity" [sacpiNumberMask]="numberMask" type="text" class="form-control text-right">
                    <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('Quantity')">
                    </sacpi-form-field-validation-messages>
                  </td>
                  <td [sacpiFormFieldValidationState]="item.get('Observation')">
                    <input formControlName="Observation" type="text" class="form-control" placeholder="Descripcion" />
                    <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('Observation')">
                    </sacpi-form-field-validation-messages>
                  </td>
                  <td class="table-view-pf-actions">
                    <div class="table-view-pf-btn">
                      <button type="button" *ngIf="!form.valid" class="btn btn-default" disabled>
                        <span> Guardar</span>
                      </button>
                      <button type="button" (click)="save(form,item)" [disabled]="itemworking" *ngIf="form.valid" class="btn btn-default">
                        <span [hidden]="!itemworking">Guardando...</span>
                        <span [hidden]="itemworking">Guardar</span>
                      </button>
                    </div>                 
                  </td>
                  <td class="table-view-pf-actions">
                    <div class="dropdown dropdown-kebab-pf">
                      <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        <span class="fa fa-ellipsis-v"></span>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownKebabRight">
                        <li>
                          <a href="#" (onclick)="removeDetalleFormControl(i)">Eliminar</a>
                        </li>
                      </ul>
                    </div>
                  </td>
                  <td [sacpiFormFieldValidationState]="item.get('Acomulate')">
                    <input formControlName="Acomulate" [sacpiNumberMask]="numberMask" type="text" class="form-control text-right" readonly>
                    <sacpi-form-field-validation-messages [sacpiFormControl]="item.get('Acomulate')">
                    </sacpi-form-field-validation-messages>
                  </td>
                </tr>
              </ng-template>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="10" class="text-right">
                  <button (click)="addDetalleFormControl()" type="button" class="btn btn-default">
                    <span class="fa fa-plus"></span> Agregar Productos
                  </button>
                </td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
      <br>
      <sacpi-button-confirmar (sacpiConfirmar)="confirmar()"></sacpi-button-confirmar>
      <sacpi-button-cancel (sacpiOnCancel)="cancel()"></sacpi-button-cancel>
    </form>
    <br>
  </div>
</div>